parameters:
  - name: PRId
    type: string
    default: ' '
  - name: PRId2
    type: string
    default: ' '
  - name: OrgName
    type: string
    default: 'DevDiv'
  - name: ProjectName
    type: string
    default: 'DevDiv'
  - name: RepoName
    type: string
    default: 'VS'
  - name: VSBaseUrl
    type: string
    default: 'https://dev.azure.com'
  - name: ExpiredDays
    type: string
    default: '90'
  - name: MaxPRToAbandon
    type: string
    default: '50'

trigger: none

pr:
  branches:
    include:
    - main

pool:
  vmImage: 'windows-latest'

stages:
- stage: Test
  displayName: Test Stage
  jobs:
  - job: Scan 
    displayName: 'Scan Solutions'
    steps:
    - pwsh: |
        $prId = "${{ parameters.PRId }}".Trim()
        if ($prId -eq "") {
          Write-Host "PRId is not provided, defaulting to empty string."
          $extrParm = ""
        } else {
          Write-Host "PRId is provided: $prId"
          $extrParm = " PRId:$prId"
        }
        Write-Host "'$extrParm'"

        $prId2 = "${{ parameters.PRId2 }}".Trim()
        if ($prId2 -eq "") {
          Write-Host "PRId2 is not provided, defaulting to empty string."
          $extrParm2 = ""
        } else {
          Write-Host "PRId2 is provided: $prId2"
          $extrParm2 = " PRId2:$prId2"
        }
        Write-Host "'$extrParm2'"

        $paramString = "OrgName:${{ parameters.OrgName }} ProjectName:${{ parameters.ProjectName }} RepoName:${{ parameters.RepoName }} VsUri:${{ parameters.VSBaseUrl }} ExpirePROlderThan:${{ parameters.ExpiredDays }} MaxPRToAbandon:${{ parameters.MaxPRToAbandon }} AccessToken:$env:ACCESSTOKEN"
        Write-Host "Parameter string: '$paramString'"
        $paramString += $extrParm
        Write-Host "Parameter string: '$paramString'"
        $paramString += $extrParm2
        Write-Host "Final parameter string: '$paramString'"
      displayName: 'Test'