parameters:
  - name: PRId # tttt
    type: string
    default: ' '
  - name: OrgName
    type: string
    default: 'DevDiv'
  - name: ProjectName
    type: string
    default: 'DevDiv'

trigger: none

pr:
  branches:
    include:
    - main

pool:
  vmImage: 'windows-latest'

stages:
- stage: Test
  displayName: Test Stage
  jobs:
  - job: Scan 
    displayName: 'Scan Solutions'
    steps:
    - pwsh: |
        $paramString =
          "OrgName:${{ parameters.OrgName }} " +
          "ProjectName:${{ parameters.ProjectName }} " +
          "RepoName:${{ parameters.RepoName }} " +
          "VsUri:${{ parameters.VSBaseUrl }} " +
          "ExpirePROlderThan:${{ parameters.ExpiredDays }} " +
          "MaxPRToAbandon:${{ parameters.MaxPRToAbandon }}"

        if ($prId -ne "") {
          $exeArgs += "PRId:$prId"
        }

        $exeArgs += "AccessToken:$env:ACCESSTOKEN"
        Write-Host "Running: $exePath @exeArgs"
      displayName: 'Test'
    - pwsh: |
        $exeArgs = @(
          "OrgName:${{ parameters.OrgName }}"
          "ProjectName:${{ parameters.ProjectName }}"
          "RepoName:${{ parameters.RepoName }}"
          "VsUri:${{ parameters.VSBaseUrl }}"
          "ExpirePROlderThan:${{ parameters.ExpiredDays }}"
          "MaxPRToAbandon:${{ parameters.MaxPRToAbandon }}"
        )

        if ($prId -ne "") {
          $exeArgs += "PRId:$prId"
        }

        $exeArgs += "AccessToken:$env:ACCESSTOKEN"
        Write-Host "Running: $exePath @exeArgs"
      displayName: 'Test'